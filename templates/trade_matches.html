{% extends "base.html" %}

{% block content %}

<div class="container mx-auto p-4">
    {% if not request.user.profile.is_trading_active %}
    <div class="hero min-h-32 bg-base-200 rounded-box mb-6">
        <div class="hero-content text-center">
            <div class="max-w-md">
                <h1 class="text-3xl font-bold">Your Trade Matches</h1>
                <p class="py-2">You don't have trading enabled! Head to your profile to set yourself as open to trading!</p>
            </div>
        </div>
    </div>
    {% if message %}
    <div class="alert alert-info shadow-lg">
        <div>
            <span>{{ message }}</span>
        </div>
    </div>
    {% endif %}
    {% else %}
    <div class="hero min-h-32 bg-base-200 rounded-box mb-6">
        <div class="hero-content text-center">
            <h1 class="text-3xl font-bold">Find Trade</h1>
            <p>Select a card from your wishlist to generate potential trade matches!</p>
        </div>
    </div>
    {% if message %}
    <div class="alert alert-info shadow-lg">
        <div>
            <span>{{ message }}</span>
        </div>
    </div>
    {% endif %}

    {% if form.fields.wanted_card.queryset.exists %}
    <form method="post" class="form-control mb-6">
        {% csrf_token %}
        <label class="label" for="{{ form.wanted_card.id_for_label }}">Wanted Card:</label>
        {{ form.wanted_card }}
        <button class="btn btn-primary mt-4" type="submit">Generate Trades</button>
    </form>
    {% else %}
    <div class="alert alert-info">No items on your wishlist! Add some to start trading!</div>
    {% endif %}

    {% if matches %}
    <form method="post" action="{% url 'propose_trades' %}">
        {% csrf_token %}
        <div class="overflow-x-auto">
            <table class="table table-zebra w-full">
                <thead>
                    <tr>
                        <th>Select</th>
                        <th>Trader</th>
                        <th>You Receive</th>
                        <th>You Offer</th>
                    </tr>
                </thead>
                <tbody>
                    {% for match in matches %}
                    <tr>
                        <td><input type="checkbox" name="selected_matches" value="{{ match.recipient.id }}|{{ match.received_card.id }}|{{ match.offered_card.id }}" /></td>
                        <td>{{ match.anon_name }}</td>
                        <td>{{ match.received_card.name }} ({{ match.received_card.tcg_id }})</td>
                        <td>
                            {{ match.offered_card.name }} ({{ match.offered_card.tcg_id }})
                            {% if match.is_same_set %}<div class="badge badge-primary ml-2">Same Set</div>{% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <button class="btn btn-accent mt-4" type="submit">Send Selected Trade Requests!</button>
        </div>
    </form>
    {% else %}
    {% if request.method == 'POST' %}
    <div class="alert alert-warning mt-4">No matches found for this card. Try another from your wishlist or check back later.</div>
    {% endif %}
    {% endif %}
    {% endif %}
</div>

{% endblock %}
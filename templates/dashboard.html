{% extends "base.html" %}

{% block content %}
<div class="card bg-base-100 shadow-xl">
    <div class="card-body">
        <h2 class="card-title">You Collection Dashboard</h2>
        <p>Total Cards: {{ total_cards }}</p>
        <h3>Sets Summary</h3>
        <ul>
            {% for summary in sets_summary %}
            <li>{{ summary.card__card_set__name }}: {{ summary.count }} unique cards ({{ summary.completion|floatformat:1 }}% complete), {{ summary.total_quantity }} total</li>
            {% endfor %}
        </ul>
        <p>Trading Active: {% if request.user.profile.is_trading_active %}Yes{% else %}No{% endif %}</p>

        <h3>Your Cards</h3>
        <a href="{% url 'add_collection' %}">Add New card</a>
        <a href="{% url 'export_collections' %}">Export My Collection to CSV</a>
        <a href="{% url 'import_collections' %}">Import My Collection from CSV</a>
        <table class="table w-full">
            <tr><th>Card</th><th>Rarity</th><th>Set</th><th>Quantity</th><th>Image</th></tr>
            {% for item in collections %}
            <tr>
                <td>{{ item.card.name }} ({{ item.card.tcg_id }})</td>
                <td>{{ item.card.rarity }}</td>
                <td>{{ item.card.card_set.name }}</td>
                <td>{{ item.quantity }}</td>
                <td><img src="{{ item.card.image_base }}/low.png" alt="{{ item.card.name }}"></td>
                <td><a href="{% url 'edit_collection' item.pk %}" class="btn btn-primary btn-xs">Edit</a></td>
            </tr>
            {% empty %}
            <tr><td colspan="5">No cards yet.</td></tr>
            {% endfor %}
        </table>

        <h3>Your "Wants"</h3>
        <a href="{% url 'add_want' %}">Add Want</a>
        <table class="table w-full">
            <tr><th>Card</th><th>Rarity</th><th>Set</th><th>Desired Quantity</th></tr>
            {% for item in wants %}
            <tr>
                <td>{{ item.card.name }} ({{ item.card.tcg_id }})</td>
                <td>{{ item.card.rarity }}</td>
                <td>{{ item.card.card_set.name }}</td>
                <td>{{ item.desired_quantity }}</td>
                <td><a href="{% url 'edit_want' item.pk %}" class="btn btn-primary btn-xs">Edit</a></td>
            </tr>
            {% empty %}
            <tr><td colspan="5">No "wants" yet.</td></tr>
            {% endfor %}
        </table>

        <h3>Your "Haves" For Trade</h3>
        <table class="table w-full">
            <tr><th>Card</th><th>Rarity</th><th>Set</th><th>Quantity Owned</th></tr>
            {% for item in collections %}
            {% if item.for_trade %}
            <tr>
                <td>{{ item.card.name }} ({{ item.card.tcg_id }})</td>
                <td>{{ item.card.rarity }}</td>
                <td>{{ item.card.card_set.name }}</td>
                <td>{{ item.quantity }}</td>
            </tr>
            {% endif %}
            {% empty %}
            <tr><td colspan="5">No "haves" yet.</td></tr>
            {% endfor %}
        </table>

        <h3>Rarity Breakdown</h3>
        <table class="table w-full">
            <tr><th>Rarity</th><th>Unique Owned</th><th>Total Quantity</th></tr>
            {% for stat in rarity_stats %}
            <tr>
                <td>{{ stat.card__rarity }}</td>
                <td>{{ stat.owned_count }}</td>
                <td>{{ stat.total_quantity }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="5">No data yet.</td></tr>
            {% endfor %}
        </table>

        <h3>Best Booster Picker (Chance of New Card)</h3>
        {% for set_name, boosters in booster_probs_by_set.items %}
        <h4>{{ set_name }}</h4>
        <ul>
            {% for name, prob in boosters %}
            <li>{{ name }}: {{ prob|floatformat:2 }}%</li>
            {% endfor %}
        </ul>
        {% empty %}
        <li>No boosters available</li>
        {% endfor %}
    </div>
</div>
{% endblock %}